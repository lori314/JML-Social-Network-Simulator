# 基于JML规格的社交网络模拟器 (数据结构与算法优化实践)

## 1. 项目背景

这是我在面向对象课程中，完成的一系列关于**规格化设计 (Design by Contract)** 的编程作业。

项目的核心任务是，根据官方提供的、使用**JML (Java Modeling Language)** 书写的形式化规格 (`.java`接口文件)，从零开始编写一个能够正确、高效运行的社交网络模拟器。

这个项目不仅仅是简单的Java编程练习，它更是一次深刻的、从**理论规格到高效工程实现**的转化挑战。规格只定义了“做什么”，而“如何做得又快又好”则是我需要通过**算法设计、数据结构选择和性能优化**来解决的核心问题。

---

## 2. 核心功能与挑战

本社交网络模拟器支持以下核心功能：
*   **人员网络管理:** 添加/查询用户，建立/修改/查询用户间的社交关系和亲密度。
*   **群组 (Tag) 功能:** 用户可以创建标签（群组），并邀请好友加入。
*   **消息系统:** 支持多种类型的消息（普通、表情、红包、转发）在用户间或群组内发送。
*   **图论算法查询:**
    *   查询网络中任意两人的连通性 (`isCircle`)。
    *   查询网络中任意两人间的最短社交路径 (`queryShortestPath`)。
    *   查询网络中的三元环数量 (`queryTripleSum`)。

其中，最大的挑战在于**处理大规模数据查询时的性能问题**。JML规格本身不关心性能，一个简单的O(n³)实现虽然能满足规格，但在实际评测中会严重超时。因此，我的主要工作都聚焦于此。

---

## 3. 我的性能优化策略

为了应对性能挑战，我针对几个核心的查询方法，设计并实现了基于**缓存和增量更新**的优化策略。

#### **a. 连通性查询 (`isCircle`) - 并查集 (DSU) 的应用**
*   **问题:** 频繁的`isCircle`查询如果每次都用BFS/DFS，效率低下。
*   **我的解决方案:** 我在`Network`类的底层，使用**并查集 (Disjoint Set Union)** 数据结构来维护整个社交网络的连通分量。
    *   每次`addRelation`时，就对两个人的集合执行`union`操作。
    *   每次`isCircle`查询时，只需判断两个人是否在同一个集合中 (`find`操作)。
    *   这使得`isCircle`的查询时间复杂度从O(V+E)（V是人数，E是关系数）**优化到了近乎O(1)**。

#### **b. 三元环查询 (`queryTripleSum`) - 增量更新与缓存**
*   **问题:** 暴力枚举三元环的复杂度是O(V³)，无法接受。
*   **我的解决方案:** 我设置了一个缓存变量`tripleSum`。这个变量的维护被**分摊**到了每次添加或删除关系的操作中。
    *   当添加一条边`(u, v)`时，我遍历`u`的所有邻居`w`，检查`w`是否也与`v`相连。每找到一个这样的`w`，就形成了一个新的三元环`(u, v, w)`，此时将`tripleSum`加一。
    *   删除边的逻辑则相反。
    *   这使得`queryTripleSum`的查询时间复杂度**优化到了O(1)**。

#### **c. 标签内聚合信息查询 (`queryTagValueSum`等) - 增量更新**
*   **问题:** 频繁查询一个Tag内成员的总亲密度或年龄方差，如果每次都实时计算，会非常耗时。
*   **我的解决方案:** 我在`Tag`类内部也维护了`valueSum`等缓存变量。
    *   当向Tag中`addPerson`或`delPerson`时，**增量地**更新`valueSum`（只计算新成员与Tag内其他成员的亲密度）。
    *   当网络中的关系`modifyRelation`时，会**回调**并更新所有包含这两个人的Tag的`valueSum`。
    *   这同样将查询复杂度**优化到了O(1)**。

---

## 4. 技术与能力总结

*   **规格化设计:** 深刻理解并实践了“契约式设计”的思想，能够将形式化的JML规格精确地转化为健壮的Java代码。
*   **数据结构与算法:** 熟练运用**并查集**、**BFS**等图论算法和数据结构来解决实际的性能瓶GCC。
*   **性能优化:** 掌握了通过**缓存、增量更新和分摊分析**等技巧，对高复杂度查询进行优化的核心思想。
*   **面向接口编程:** 整个项目基于`com.oocourse.spec3`提供的接口进行开发，展现了良好的“面向接口而非面向实现”的编程习惯。

---

## 5. 如何运行

*   本项目依赖于官方提供的`com.oocourse.spec3`评测包。
*   将官方`.jar`包配置为项目的外部库后，通过官方提供的`Runner`类或自定义的`MainClass`即可运行。